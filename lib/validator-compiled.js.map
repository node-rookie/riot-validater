{"version":3,"sources":["validator.js"],"names":[],"mappings":"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","file":"validator-compiled.js","sourcesContent":["var validators = {};\n\nvar buildinValidators = [\n    {\n        name: \"required\",\n        fn: function(val){\n            return val.trim() === \"\"\n        }\n    },\n    {\n        name: 'max',\n        fn: function(val, expected){\n            return parseInt(val.trim(), 10) > expected;\n        }\n    },\n    {\n        name: 'min',\n        fn: function(val, expected){\n            return parseInt(val.trim(), 10) < expected;\n        }\n    },\n    {\n        name: 'maxlength',\n        fn: function(val, expected){\n            return val.length > expected;\n        }\n    },\n    {\n        name: 'minlength',\n        fn: function(val, expected){\n            return val.length < expected;\n        }\n    },\n    {\n        name: 'pattern',\n        fn: function(val, expected){\n            return !(new RegExp(expected)).test(val.trim());\n        }\n    }\n];\n\n/**\n * register build-in validators\n */\nbuildinValidators.map(function(validator){\n    registerValidators(validator.name, validator.fn);\n});\n\nfunction addForm(f, tag){\n    if(!f || !f.attributes || !f.attributes.name || !f.attributes.name.nodeValue){\n        throw new Error(\"form expected a name attribute\");\n    }\n    var formName = f.attributes.name.nodeValue;\n    var form = {\n        $name: formName,\n        $dirty: false,\n        $pristine: true,\n        $valid: false,\n        $invalid: true,\n        $submitted: false,\n        $error: {},\n        $ok: function(){\n            var o = exclude(this,\n                \"$name\",\n                \"$dirty\",\n                \"$pristine\",\n                \"$valid\",\n                \"$invalid\",\n                \"$submitted\",\n                \"$error\"\n            );\n            var errors = Object.keys(o).filter(function(field){\n                return o && o[field].$error && Object.keys(o[field].$error).length > 0\n            });\n            if(errors.length){\n                return false;\n            }\n            return true;\n        }\n    };\n    if(!tag.forms){\n        tag.forms = {};\n    }\n    tag.forms[form.$name] = form;\n}\n\nfunction extractInput(input, tag){\n    var rules = Object.keys(input.attributes).map(function(key){\n        var ruleName = input.attributes[key].nodeName;\n        var validVal = input.attributes[key].nodeValue;\n        if(validators[ruleName]){\n            return {\n                name: ruleName,\n                val: validVal\n            };\n        }\n        return false;\n    }).filter(function(rule){\n        return rule != false;\n    });\n    if(rules.length){\n        rules.forEach(function(rule){\n            addFormRule(input, rule, tag);\n        });\n    }\n    if(tag.forms[input.form.name]\n        && input.attributes.name\n        && input.attributes.name.nodeValue\n        && tag.forms[input.form.name][input.attributes.name.nodeValue]){\n        var field = tag.forms[input.form.name][input.attributes.name.nodeValue];\n        bindEvt(input, field, tag);\n    }\n}\n\nfunction addFormRule(input, rule, tag){\n    var inputName = input.attributes.name.nodeValue;\n    var formField = tag.forms[input.form.name][inputName];\n    if(!formField){\n        tag.forms[input.form.name][inputName] = {\n            $name: inputName,\n            $dirty: false,\n            $pristine: true,\n            $valid: true,\n            $invalid: false,\n            $error: {},\n            $rule: {}\n        };\n    }\n    tag.forms[input.form.name][inputName].$rule[rule.name] = rule.val;\n}\n\nfunction bindEvt(input, field, tag){\n    var errorMap = field.$rule;\n    input.addEventListener('input', validateHandler);\n    function validateHandler(e){\n        var val = e.target.value.trim();\n        Object.keys(errorMap).forEach(function(eKey){\n            var isInvalid = validators[eKey].apply(null, [val, errorMap[eKey]]);\n            if(isInvalid){\n                setFieldStatusInvalid(field, eKey);\n                addClass(input, 'f-invalid-' + eKey);\n            }else{\n                setFieldStatusValid(field, eKey);\n                removeClass(input, 'f-invalid-' + eKey)\n            }\n        });\n        if(Object.keys(field.$error).length > 0){\n            removeClass(input, 'f-valid');\n            addClass(input, 'f-invalid');\n        }else{\n            removeClass(input, 'f-invalid');\n            addClass(input, 'f-valid');\n        }\n        tag.update();\n    }\n    function setFieldStatusInvalid(field, key){\n        field.$invalid = true;\n        field.$valid = false;\n        field.$error[key] = true;\n    }\n    function setFieldStatusValid(field, key){\n        field.$invalid = false;\n        field.$valid = true;\n        field.$error[key] && delete field.$error[key];\n    }\n    function hasClass(el, className) {\n        if (el.classList)\n            return el.classList.contains(className);\n        else\n            return !!el.className.match(new RegExp('(\\\\s|^)' + className + '(\\\\s|$)'))\n    }\n\n    function addClass(el, className) {\n        if (el.classList)\n            el.classList.add(className);\n        else if (!hasClass(el, className)) el.className += \" \" + className\n    }\n\n    function removeClass(el, className) {\n        if (el.classList)\n            el.classList.remove(className);\n        else if (hasClass(el, className)) {\n            var reg = new RegExp('(\\\\s|^)' + className + '(\\\\s|$)');\n            el.className=el.className.replace(reg, ' ')\n        }\n    }\n}\n\n\nfunction initForm(){\n    var me = this;\n    this.on('mount', function(){\n        var tag = this;\n        walkTheDOM(this.root, function (node) {\n            if (node.nodeType === 1) {\n                if(node.tagName === 'form'.toUpperCase()){\n                    addForm(node, tag);\n                }\n                if(node.tagName === 'input'.toUpperCase()){\n                    extractInput(node, tag);\n                }\n            }\n        });\n    });\n    setTimeout(function(){\n        me.update();\n    }, 0)\n}\n\nfunction exclude(){\n    var args = [].slice.apply(arguments);\n    var o = args[0];\n    var props = args.slice(1);\n    var res = {};\n    for(var p in o){\n        if(props.indexOf(p) < 0){\n            res[p] = o[p]\n        }\n    }\n    return res;\n\n}\n\nfunction walkTheDOM(node, func) {\n    func(node);\n    node = node.firstChild;\n    while (node) {\n        walkTheDOM(node, func);\n        node = node.nextSibling;\n    }\n}\n\nfunction registerValidators(name, fn){\n    validators[name] = fn;\n}\n\nwindow.form = {\n    useForm: initForm\n};\n"]}